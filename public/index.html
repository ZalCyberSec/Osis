<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Pemilihan Ketua OSIS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
      border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); transition: 0.3s; }
    .candidate-card { transition: 0.3s; border: 3px solid transparent; }
    .candidate-card:hover { transform: translateY(-5px); border-color: #3b82f6; }
    .candidate-card.selected { border-color: #2563eb; box-shadow: 0 10px 25px rgba(37,99,235,0.3); }
    .progress-bar { height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg,#2563eb,#3b82f6); transition: width 0.5s; }
    .btn-primary { background: linear-gradient(135deg,#2563eb,#3b82f6); transition: 0.3s; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(37,99,235,0.4); }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
  <div id="app" class="w-full max-w-4xl">

<div id="name-screen" class="card p-8 text-center">
  <h1 class="text-4xl font-bold text-gray-800 mb-4">Pemilihan Ketua OSIS</h1>
  <p class="text-gray-600 mb-6">Masukkan Nama Lengkap Anda Untuk Memulai Voting</p>

  <div class="flex flex-col items-center gap-4">
    <label for="user-name" class="text-gray-700 font-medium">Nama Lengkap:</label>
    <input type="text" id="user-name" placeholder="Masukkan nama lengkap"
      class="w-full max-w-md px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
      onkeypress="if(event.key === 'Enter') saveUserName()">
    <button onclick="saveUserName()" 
      class="btn-primary text-white px-8 py-3 rounded-lg font-semibold text-lg">
      Mulai Voting
    </button>
  </div>

  <p class="mt-4 text-sm text-gray-500">ZalOfficial Since 2025</p>
</div>
    
    <div id="voting-screen" class="hidden">
      <div class="card p-8 text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800">Pilih Calon Ketua OSIS</h2>
        <p class="text-gray-600 mb-4">Selamat datang, <span id="user-greeting" class="font-semibold text-blue-600"></span></p>
        <p class="text-sm text-gray-500">Pilih Salah Satu Calon Di Bawah Ini:</p>
      </div>

      <div class="grid md:grid-cols-2 gap-6">
        <div class="candidate-card card p-6 text-center cursor-pointer" onclick="selectCandidate(1)">
          <img src="https://files.catbox.moe/fwa8s5.jpg" alt="Calon 1" class="w-full h-64 object-cover rounded-lg mb-4">
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Asep</h3>
          <p class="text-gray-600 mb-4">"Maju bersama, berprestasi untuk semua"</p>
          <div class="vote-badge hidden bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">‚úî Dipilih</div>
        </div>

        <div class="candidate-card card p-6 text-center cursor-pointer" onclick="selectCandidate(2)">
          <img src="https://placehold.co/300x400" alt="Calon 2" class="w-full h-64 object-cover rounded-lg mb-4">
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Udin</h3>
          <p class="text-gray-600 mb-4">"Inovasi untuk perubahan yang berarti"</p>
          <div class="vote-badge hidden bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">‚úî Dipilih</div>
        </div>
      </div>

      <div class="text-center mt-8">
        <button id="vote-btn" onclick="submitVote()" disabled
          class="btn-primary text-white px-8 py-3 rounded-lg font-semibold text-lg opacity-50 cursor-not-allowed">
          Kirim Vote
        </button>
      </div>
    </div>
    <div id="results-screen" class="hidden">
      <div class="card p-8 text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800">Hasil Voting</h2>
        <p class="text-gray-600">Halo <span id="result-user-name" class="font-semibold text-blue-600"></span>, Ini Hasil Voting Nya</p>
        <p class="text-sm text-gray-500 mt-2">Total Suara: <span id="total-votes" class="font-semibold">0</span></p>
      </div>

      <div class="grid md:grid-cols-2 gap-6 mb-8">
        <div class="card p-6">
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Asep</h3>
          <div class="mb-4">
            <span class="text-2xl font-bold text-blue-600" id="votes-1">0</span> <span class="text-gray-600">suara</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" id="progress-1" style="width: 0%"></div></div>
        </div>
        <div class="card p-6">
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Udin</h3>
          <div class="mb-4">
            <span class="text-2xl font-bold text-blue-600" id="votes-2">0</span> <span class="text-gray-600">suara</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" id="progress-2" style="width: 0%"></div></div>
        </div>
      </div>

      <div class="text-center">
        <button onclick="loadResults()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold">Refresh Hasil</button>
      </div>
    </div>

    <div id="thankyou-screen" class="hidden">
      <div class="card p-8 text-center">
        <h2 class="text-3xl font-bold text-gray-800 mb-4">Terimakasih Telah Memilih Calon Ketua OSIS üôè</h2>
        <p class="text-gray-600">Suara kamu sudah tersimpan dan tidak bisa diubah lagi. Created By ZalOfficial</p>
      </div>
    </div>
  </div>

  <script>
    let selectedCandidate = 0;
    let userName = '';
    const ADMIN_NAME = "adminsma6";
    const API_URL = "http://zalstecu.crutl2f.my.id:3003/api/votes";

    window.onload = () => {
      const voted = localStorage.getItem("hasVoted");
      if (voted === "true") {
        showThankYou();
      }
    };

    function saveUserName() {
      const input = document.getElementById('user-name');
      userName = input.value.trim();

      if (!userName) return alert('Silakan masukkan nama lengkap.');

      if (userName.toLowerCase() === ADMIN_NAME) {
        showResults();
      } else {
        showVotingScreen();
      }
    }

    function showVotingScreen() {
      document.getElementById('name-screen').classList.add('hidden');
      document.getElementById('voting-screen').classList.remove('hidden');
      document.getElementById('user-greeting').textContent = userName;
    }

    function selectCandidate(candidateId) {
      selectedCandidate = candidateId;
      document.querySelectorAll('.candidate-card').forEach(card => {
        card.classList.remove('selected');
        card.querySelector('.vote-badge').classList.add('hidden');
      });
      const selectedCard = document.querySelectorAll('.candidate-card')[candidateId - 1];
      selectedCard.classList.add('selected');
      selectedCard.querySelector('.vote-badge').classList.remove('hidden');

      const voteBtn = document.getElementById('vote-btn');
      voteBtn.disabled = false;
      voteBtn.classList.remove('opacity-50', 'cursor-not-allowed');
    }

    async function submitVote() {
      if (!selectedCandidate) return alert("Silakan pilih salah satu calon terlebih dahulu.");

      try {
        await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: userName, candidate: selectedCandidate })
        });
        alert("Vote berhasil dikirim!");
        localStorage.setItem("hasVoted", "true"); // tandai device sudah vote
        showThankYou();
      } catch (err) {
        console.error(err);
        alert("Gagal mengirim vote.");
      }
    }

    async function showResults() {
      document.getElementById('name-screen').classList.add('hidden');
      document.getElementById('voting-screen').classList.add('hidden');
      document.getElementById('results-screen').classList.remove('hidden');
      document.getElementById('result-user-name').textContent = userName;
      loadResults();
    }

    async function loadResults() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();

        const votes1 = data["1"] || 0;
        const votes2 = data["2"] || 0;
        const totalVotes = votes1 + votes2;

        document.getElementById('votes-1').textContent = votes1;
        document.getElementById('votes-2').textContent = votes2;
        document.getElementById('total-votes').textContent = totalVotes;

        const percent1 = totalVotes > 0 ? (votes1 / totalVotes) * 100 : 0;
        const percent2 = totalVotes > 0 ? (votes2 / totalVotes) * 100 : 0;
        document.getElementById('progress-1').style.width = percent1 + "%";
        document.getElementById('progress-2').style.width = percent2 + "%";
      } catch (err) {
        console.error(err);
        alert("Gagal memuat hasil.");
      }
    }

    function showThankYou() {
      document.getElementById('name-screen').classList.add('hidden');
      document.getElementById('voting-screen').classList.add('hidden');
      document.getElementById('results-screen').classList.add('hidden');
      document.getElementById('thankyou-screen').classList.remove('hidden');
    }
  </script>
</body>
</html>
